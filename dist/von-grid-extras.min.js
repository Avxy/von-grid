vg.GeneratedTile=function(e){e=e||{};var t={scale:1,cell:null,geometry:null,material:null};if(t=vg.util.merge(t,e),!t.cell||!t.geometry)throw new Error("Missing vg.GeneratedTile configuration");this.cell=t.cell,this.cell.GeneratedTile&&this.cell.GeneratedTile!==this&&this.cell.GeneratedTile.dispose(),this.cell.GeneratedTile=this,this.uniqueID=vg.util.generateID(),this.geometry=t.geometry,this.material=t.material,this.material||(this.material=new THREE.MeshPhongMaterial({color:vg.util.randomizeRGB("30, 30, 30",13)})),this.objectType=vg.GeneratedTile,this.entity=null,this.userData={},this.selected=!1,this.highlight="0x0084cc",this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.userData.structure=this,this.position=this.mesh.position,this.rotation=this.mesh.rotation,this.rotation.x=90*vg.DEG_TO_RAD,this.mesh.scale.set(t.scale,t.scale,1),this.material.emissive?this._emissive=this.material.emissive.getHex():this._emissive=null},vg.GeneratedTile.prototype={select:function(){return this.material.emissive&&this.material.emissive.setHex(this.highlight),this.selected=!0,this},deselect:function(){return null!==this._emissive&&this.material.emissive&&this.material.emissive.setHex(this._emissive),this.selected=!1,this},toggle:function(){return this.selected?this.deselect():this.select(),this},dispose:function(){this.cell&&this.cell.GeneratedTile&&(this.cell.GeneratedTile=null),this.cell=null,this.position=null,this.rotation=null,this.mesh.parent&&this.mesh.parent.remove(this.mesh),this.mesh.userData.structure=null,this.mesh=null,this.material=null,this.userData=null,this.entity=null,this.geometry=null,this._emissive=null}},vg.GeneratedTile.prototype.constructor=vg.GeneratedTile,vg.GeneratedTileManager=function(e){this.board=e,this.geoGen=null,this.overlay=null},vg.GeneratedTileManager.prototype={makeTiles:function(e){this.board.reset(),this.makeGenerator();var t,i,s,h;s=this.geoGen.makeTileGeo({height:e||1});var l=[];for(t=0;10>t;t++)l.push(new THREE.MeshPhongMaterial({color:vg.util.randomizeRGB("30, 30, 30",13)}));for(t in this.board.grid.cells)i=this.board.grid.cells[t],h=new vg.GeneratedTile({cell:i,geometry:s,material:l[vg.util.randomInt(0,9)],scale:1}),h.position.copy(this.board.grid.cellToPixel(i)),h.position.y=i.h*this.board.tileHeightStep,this.board.tiles.push(h),this.board.tileGroup.add(h.mesh)},makeGenerator:function(){if(!this.geoGen)switch(this.board.grid.type){case vg.HEX:this.geoGen=new vg.HexGeoGenerator}this.geoGen.init(this.board.grid.cellSize)},makeOverlay:function(e){var t=new THREE.LineBasicMaterial({color:0,opacity:.3});this.makeGenerator(),this.overlay&&this.board.group.remove(this.overlay),this.overlay=new THREE.Object3D,this.geoGen.makeOverlay(this.overlay,e,t),this.board.group.add(this.overlay)}},vg.HexGeoGenerator=function(){this.tileGeo=null,this.tileShape=null,this.flatGeo=null,this.shapeGeo=null,this.vertices=null,this._cel=new vg.Cell,this._vec3=new THREE.Vector3,this._tileSize=-1,this._cellWidth=0,this._cellLength=0},vg.HexGeoGenerator.prototype={init:function(e){if(this.flatGeo&&this.flatGeo.dispose(),this.shapeGeo&&this.shapeGeo.dispose(),e!==this._tileSize){this._tileSize=e||10,this._cellWidth=2*this._tileSize,this._cellLength=.5*vg.SQRT3*this._cellWidth;var t,i,s,h=[];for(t=0;6>t;t++)i=vg.TAU/6*t,s=new THREE.Vector3(this._tileSize*Math.cos(i),0,this._tileSize*Math.sin(i)),h.push(s);for(this.vertices=h,this.tileShape=new THREE.Shape,this.tileShape.moveTo(h[0].x,h[0].z),t=1;6>t;t++)this.tileShape.lineTo(h[t].x,h[t].z);this.tileShape.lineTo(h[0].x,h[0].z),this.tileShape.autoClose=!0,this.shapeGeo=new THREE.ShapeGeometry(this.tileShape),this.shapeGeo.rotateX(90*vg.DEG_TO_RAD),this.shapeGeo.verticesNeedUpdate=!0,this.flatGeo=new THREE.Geometry,this.flatGeo.vertices=h,this.flatGeo.verticesNeedUpdate=!0}},makeTileGeo:function(e){e=e||{};var t={amount:1,bevelEnabled:!1,bevelSegments:1,steps:1,bevelSize:.5,bevelThickness:.5};return vg.util.overwrite(t,e),t.amount=e.height||t.amount,this.tileGeo&&this.tileGeo.dispose(),this.tileGeo=new THREE.ExtrudeGeometry(this.tileShape,t),this.tileGeo},makeTilePoly:function(e){e||(e=new THREE.MeshBasicMaterial({color:2405631}));var t=new THREE.Mesh(this.shapeGeo,e);return t},makeTileHighlight:function(e){var t=require("nexus").grid;e||(e=new THREE.MeshBasicMaterial({color:2405631}));var i=new THREE.TorusGeometry(t.cellSize,2,3,6),s=new THREE.Mesh(i,e);return s.rotateX(vg.PI/2),s.scale.x=.8,s.scale.y=.8,s},makeOverlay:function(e,t,i){var s,h,l,o=this.tileShape.createPointsGeometry();for(s=-t;t+1>s;s++)for(h=-t;t+1>h;h++)if(l=-s-h,Math.abs(s)<=t&&Math.abs(h)<=t&&Math.abs(l)<=t){this._cel.set(s,h,l);var r=new THREE.Line(o,i);r.position.copy(this._cellToPixel(this._cel)),r.position.y=.5,r.rotation.x=90*vg.DEG_TO_RAD,e.add(r)}},_cellToPixel:function(e){return this._vec3.x=e.q*this._cellWidth*.75,this._vec3.y=e.h,this._vec3.z=-((e.s-e.r)*this._cellLength*.5),this._vec3}},vg.Scene=function(e,t){var i={element:document.body,alpha:!0,antialias:!0,clearColor:"#fff",sortObjects:!1,fog:null,light:null,lightPosition:null,cameraType:"PerspectiveCamera",cameraPosition:null,orthoZoom:4},s={minDistance:100,maxDistance:1e3,zoomSpeed:2,noZoom:!1};if(i=vg.util.merge(i,e),"boolean"!=typeof t&&(s=vg.util.merge(s,t)),this.renderer=new THREE.WebGLRenderer({alpha:i.alpha,antialias:i.antialias}),this.renderer.setClearColor(i.clearColor,0),this.renderer.sortObjects=i.sortObjects,this.width=window.innerWidth,this.height=window.innerHeight,this.orthoZoom=i.orthoZoom,this.container=new THREE.Scene,this.container.fog=i.fog,i.light||(i.light=new THREE.DirectionalLight(14540253),this.container.add(new THREE.AmbientLight(14540253))),i.lightPosition||i.light.position.set(-1,1,-1).normalize(),this.container.add(i.light),"OrthographicCamera"===i.cameraType){var h=window.innerWidth/this.orthoZoom,l=window.innerHeight/this.orthoZoom;this.camera=new THREE.OrthographicCamera(h/-2,h/2,l/2,l/-2,1,5e3)}else this.camera=new THREE.PerspectiveCamera(50,this.width/this.height,1,5e3);this.contolled=!!t,this.contolled&&(this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),vg.util.overwrite(this.controls,s)),i.cameraPosition&&this.camera.position.copy(i.cameraPosition),window.addEventListener("resize",function(){if(this.width=window.innerWidth,this.height=window.innerHeight,"OrthographicCamera"===this.camera.type){var e=this.width/this.orthoZoom,t=this.height/this.orthoZoom;this.camera.left=e/-2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=t/-2}else this.camera.aspect=this.width/this.height;this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}.bind(this),!1),this.attachTo(i.element)},vg.Scene.prototype={constructor:vg.Scene,attachTo:function(e){e.style.width=this.width+"px",e.style.height=this.height+"px",this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),e.appendChild(this.renderer.domElement)},add:function(e){this.container.add(e)},remove:function(e){this.container.remove(e)},render:function(){this.contolled&&this.controls.update(),this.renderer.render(this.container,this.camera)},updateOrthoZoom:function(){if(this.orthoZoom<=0)return void(this.orthoZoom=0);var e=this.width/this.orthoZoom,t=this.height/this.orthoZoom;this.camera.left=e/-2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=t/-2,this.camera.updateProjectionMatrix()},focusOn:function(e){this.camera.lookAt(e.position)}},vg.SelectionManager=function(e){this.mouse=e,this.onSelect=new vg.Signal,this.onDeselect=new vg.Signal,this.selected=null,this.toggleSelection=!1,this.mouse.signal.add(this.onMouse,this)},vg.SelectionManager.prototype={select:function(e,t){e&&(t=t||!0,this.selected!==e&&this.clearSelection(t),e.selected?this.toggleSelection&&(t&&this.onDeselect.dispatch(e),e.deselect()):e.select(),this.selected=e,t&&this.onSelect.dispatch(e))},clearSelection:function(e){e=e||!0,this.selected&&(e&&this.onDeselect.dispatch(this.selected),this.selected.deselect()),this.selected=null},onMouse:function(e,t){switch(e){case vg.MouseCaster.DOWN:t||this.clearSelection();break;case vg.MouseCaster.CLICK:this.select(t)}}},vg.SelectionManager.prototype.constructor=vg.SelectionManager,vg.Tile=function(e){e=e||{};var t={scale:1,cell:null,geometry:null,material:null};if(t=vg.util.merge(t,e),!t.cell||!t.geometry)throw new Error("Missing vg.Tile configuration");this.cell=t.cell,this.cell.tile&&this.cell.tile!==this&&this.cell.tile.dispose(),this.cell.tile=this,this.uniqueID=vg.util.generateID(),this.geometry=t.geometry,this.material=t.material,this.material||(this.material=new THREE.MeshPhongMaterial({color:vg.util.randomizeRGB("30, 30, 30",13)})),this.objectType=vg.TILE,this.entity=null,this.userData={},this.selected=!1,this.highlight="0x0084cc",this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.userData.structure=this,this.position=this.mesh.position,this.rotation=this.mesh.rotation,this.rotation.x=90*vg.DEG_TO_RAD,this.mesh.scale.set(t.scale,t.scale,1),this.material.emissive?this._emissive=this.material.emissive.getHex():this._emissive=null},vg.Tile.prototype={select:function(){return this.material.emissive&&this.material.emissive.setHex(this.highlight),this.selected=!0,this},deselect:function(){return null!==this._emissive&&this.material.emissive&&this.material.emissive.setHex(this._emissive),this.selected=!1,this},toggle:function(){return this.selected?this.deselect():this.select(),this},dispose:function(){this.cell&&this.cell.tile&&(this.cell.tile=null),this.cell=null,this.position=null,this.rotation=null,this.mesh.parent&&this.mesh.parent.remove(this.mesh),this.mesh.userData.structure=null,this.mesh=null,this.material=null,this.userData=null,this.entity=null,this.geometry=null,this._emissive=null}},vg.Tile.prototype.constructor=vg.Tile;
//# sourceMappingURL=von-grid-extras.min.js.map
